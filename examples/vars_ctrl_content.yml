# Ansible Automation Platform controller configuration - content

aap_configuration_secure_logging: false
controller_configuration_organizations_secure_logging: false
controller_configuration_credential_types_secure_logging: false
controller_configuration_credentials_secure_logging: false
controller_configuration_execution_environments_secure_logging: false
controller_configuration_projects_secure_logging: false
controller_configuration_inventories_secure_logging: false

aap_organizations:
  - name: Test Org
    description: Test organization
    max_hosts: 10
    instance_groups:
      - default
    default_environment: Custom Base EE
    # NB. At least one credential needs to be
    #     defined if downloading collections.
#    galaxy_credentials:
#      - Automation Hub RH Certified Repository
#      - Automation Hub Validated Repository
#      - Automation Hub Community Repository
#      - Automation Hub Published Repository

controller_credential_types:
  - name: Kerberos
    inputs:
      fields:
        - id: username
          type: string
          label: Username
        - id: password
          type: string
          label: Password
          secret: true
        - id: default_realm
          type: string
          label: Default Realm
        - id: kdc
          type: string
          label: KDC
          help_text: Optional KDC, use only if KDC DNS lookup not working
      required:
        - username
        - password
        - default_realm
    injectors:
      env:
        KRB5_CONFIG: !unsafe "{{ tower.filename }}"
      file:
        template: !unsafe |-
          [libdefaults]
          default_realm = {{ default_realm | upper }}
          dns_canonicalize_hostname = fallback
          dns_lookup_realm = {% if kdc %}false{% else %}true{% endif %}
          dns_lookup_kdc = {% if kdc %}false{% else %}true{% endif %}
          forwardable = true
          [realms]
          {{ default_realm | upper }} = {
            default_domain = {{ default_realm | lower }}
            {% if kdc %}kdc = {{ kdc }}{% endif %}
          }
      extra_vars:
        ansible_user: !unsafe "{{ username }}"
        ansible_password: !unsafe "{{ password }}"

controller_credentials:
  - name: Automation Hub Container Registry
    organization: Test Org
    credential_type: Container Registry
    inputs:
      username: "{{ aap_admin_username | default('admin') }}"
      password: "{{ aap_admin_password }}"
  - name: Test Credential
    organization: Test Org
    credential_type: Machine
    inputs:
      username: "{{ test_machine_username | default('admin') }}"
      password: "{{ test_machine_password | default('Foobar_12') }}"
      #ssh_key_data: "{{ lookup('file', lookup('env', 'PWD') + '/id_ed25519') }}"
      #ssh_key_unlock: "{{ ssh_key_passphrase | default(omit) }}"

controller_execution_environments:
  - name: Custom Base EE
    image: gateway.example.com/custom/custom-base-rhel9
    pull: always
    #pull: missing
    credential: Automation Hub Container Registry

controller_projects:
  - name: Test Project
    description: Project for testing
    organization: Test Org
    default_environment: Custom Base EE
    scm_type: git
    scm_url: https://git.example.com/example.git
    scm_clean: true
    scm_update_on_launch: true
    scm_update_cache_timeout: "30"
    update_project: true

controller_inventories:
  - name: Test Inventory
    description: Inventory for testing
    organization: Test Org

controller_templates:
  - name: Test Job Template
    description: Job template for testing
    job_type: run
    organization: Test Org
    inventory: Test Inventory
    project: Test Project
    playbook: example.yml
    credentials: Test Credential
    verbosity: "0"
